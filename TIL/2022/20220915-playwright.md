# Playwright

Playwright 는 마이크로 소프트에서 만든 테스팅 도구입니다.

다양한 브라우저(), 환경() 에서 실행할 수 있습니다.

전체 테스트 구성이나 흐름은 cypress, jest 와 비슷한 형태를 취하고 있습니다.

### 설치

설치하는 방법은 간단합니다.

npm playwright init 할 수 있고, vscode 에서 할 수 있습니다.

일렉트론을 사용한다면 일렉트론에서 권장하는 설정으로 다운로드 할 수도 있습니다.

init 을 하면 몇가지를 물어봅니다.

취사선택을 하면됩니다.

일단 다 받아보겠습니다.

여러 파일들이 함께 생성되는데요

먼저 github actions 가 있습니다.

액션의 디테일한 설정은 프로젝트 환경에 맞춰 수정이 필요할 수 있습니다.

아래쪽에 있는 아티팩트는 액션의 결과물을 저장하고 유지할 수 있게 해줍니다.

여기서는 테스트를 한 뒤 생성되는 리포트를 볼 수 있습니다.

### 테스트 작성

테스트는 test 구문으로 감싼 뒤 원하는 테스트를 실행할 수 있습니다.

jest 의 expect library 를 사용하고 있어 여러가지 assertion 을 사용할 수 있고,

추가적으로 async matcher 에 대한 부분이 확장되어 상태의 비동기적인 변화를 테스트 할 수 있습니다.

**generate**

테스트를 제너레이트 할 수 있는 도구를 제공합니다.

… 를 통해 실행할 수 있습니다.

실행하면 테스트하고자 하는 브라우저와 인스펙터가 뜨는 걸 볼 수 있습니다.

브라우저에 저희가 원하는 액션을 하면 인스펙터에 그 액션을 분석하여 테스트 코드로 만들어 줍니다.

간단하게 테스트의 틀을 짤 수 있습니다.

playwright 는 auto waiting 을 해주기 때문에 액션의 결과로 변경되는 엘리먼트를 테스트해야 할 경우에도 따로 웨이팅을 명시하지 않아도 자동으로 해당 엘리먼트가 테스트 수행 가능한 시점까지 기다려 줍니다.

물론 명시적으로 웨이팅을 할 수도 있습니다.

간혹 hide resolve(에러명 첨부) 같이 액션은 잘 수행이 됐으나 다음 엘리먼트를 읽지 못하는 경우가 있을 수 있습니다. 이 때 디버그 모드를 켜고 스텝오버로 진행을 해보면 통과할 수 있는데 이건 테스트 하려는 앱의 코드에 따른 것일 수 있습니다. 스텝 오버로 잘 통과가 된다면 컨피그의 slowMo 를 설정하거나 액션에 딜레이를 줄 수 있습니다.

각 테스트는 독립접입니다. 클린하게 유지됩니다. 페이지나 브라우저, 컨텍스트를 통해 더 효율적으로 관리할 수도 있습니다.

### authentication

로그인이 필요한 테스트 환경일 경우 이를 해결하는 방법은 여러가지가 있습니다.

간단하게 beforeEach 를 돌리거나, 로그인 상태를 테스트들에서 공유하거나, api 로 로그인하는 방식이 있을 수 있습니다.

beforeEach 는 간단하고 확실하지만 비효율적입니다.

로그인하는 경우가 특정 케이스에 한정된다면 간편하게 사용할 수 있겠습니다.

Playwright 에서 권장하는 것은 상태를 공유하는 방법입니다.

글로벌 상태에서 로그인을 수행하고 이때의 상태(로컬스토리지, 쿠기)를 이후 테스트에서 동일하게 반영할 수 있게 합니다.

global-setup 파일을 설정합니다.

…코드…

이렇게 설정하면 로그인을 수행하고 이때의 상태를 스냅샷을 떠서 storageState.json 에 저장하게 됩니다.

여기서 파일명은 원하는 이름으로 만들면 됩니다.

이제 global-setup 과 storageState.json 을 컨피그 파일에 설정합니다.

그러면 이 json 파일을 각 테스트에서 활용할 수 있게 됩니다.

위의 내용은 @playwright/test 를 사용할 때의 예입니다.

playwright(?) 를 사용하면 다른 페이지(링크 제공)가 있습니다.

위 페이지를 보면 cli 를 통해 실행하고, json 을 만드는 등의 작업을 할 수 있습니다.

이렇게 설정한 뒤 테스트를 진행하면 테스트가 시작되고 페이지로 진입했을 때 로그인 상태인 것을 확인할 수 있습니다.
