# Test Organization 테스트 조직화

- 단위 테스트(unit test)
  - 작고 하나에 더 집중하며, 한 번에 하나의 모듈만 분리하여 테스트하고, 비공개 인터페이스(private interface)를 테스트 함.
- 통합 테스트(integration test)

  - 완전히 라이브러리 외부에 있으며, 공개 인터페이스(public interface)를 이용하고 테스트마다 여러 개의 모듈을 잠재적으로 실험함으로써, 다른 외부의 코드가 하는 방식과 동일한 형태로 코드를 이용함.

- 두 종류의 테스트 작성 모두가 라이브러리 코드 조각들이 따로따로 혹은 함께 사용되었을 때 기대하는 바와 같이 작동하는 지를 확신시키는데 중요함.

## 단위 테스트

- 단위 테스트의 목적은 각 코드의 단위를 나머지 부분과 분리하여 테스트하는 것인데, 이는 코드가 어디 있고 어느 부분이 기대한 대로 동작하지 않는지를 빠르게 정확히 찾아낼 수 있도록 하기 위함.

- 단위 테스트는 src 디렉토리 내에 넣는데, 각 파일마다 테스트하는 코드를 담고 있음.

- 관례는 각 파일마다 테스트 함수를 담고 있는 `tests`라는 이름의 모듈을 만들고, 이 모듈에 `cfg(test)`라고 어노테이션 하는 것.

### 테스트 모듈과 `#[cfg(test)]`

- 테스트 모듈 상의 `#[cfg(test)]` 어노테이션은 러스트에게 우리가 `cargo build`를 실행시킬 때가 아니라 `cargo test`를 실행시킬 때에만 컴파일하고 실행시키라고 말해줌.

- 이는 라이브러리만 빌드하고 싶을 때 컴파일 시간을 절약시켜주고, 테스트가 포함되어 있지 않으므로 컴파일 결과물의 크기를 줄여줌.

- 통합 테스트는 다른 디렉토리에 위치하기 때문에, 여기에는 #[cfg(test)] 어노테이션이 필요치 않음을 앞으로 보게 될 것입니다. 하지만, 단위 테스트가 해당 코드와 동일한 파일에 위치하기 때문에, #[cfg(test)]를 사용하여 컴파일 결과물에 이들이 포함되지 않아야 함을 특정합니다.

- `cfg` 속성은 _환경 설정(configuration)_ 을 의미하며, 러스트에게 뒤따르는 아이템이 특정한 환경 값에 대해서만 포함되어야 함을 말해줌.

- 위의 경우, 환경 값이 `test`인데, 테스트를 컴파일하고 실행하기 위해 러스트로부터 제공되는 것.

### 비공개 함수 테스트하기

```rs

#![allow(unused)]
fn main() {
pub fn add_two(a: i32) -> i32 {
    internal_adder(a, 2)
}

fn internal_adder(a: i32, b: i32) -> i32 {
    a + b
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn internal() {
        assert_eq!(4, internal_adder(2, 2));
    }
}
}
```

Listing 11-12: 비공개 함수 테스트하기

`internal_adder` 함수는 `pub`으로 표시되어 있지 않지만, 테스트가 그저 러스트 코드일 뿐이고 `tests` 모듈도 그냥 또 다른 모듈이기 때문에, `internal_adder를` 불러들여 호출하는 것이 그냥 되는 것을 주목하세요. 만약 여러분이 비공개 함수를 테스트해야 한다고 생각하지 않는다면, 러스트에서는 여러분이 그렇게 하도록 강제할 일은 없습니다.

## 통합 테스트

- 러스트에서 통합 테스트들은 완전히 라이브러리 외부에 있음.

- 이들은 라이브러리를 다른 코드들과 동일한 방식으로 이용하는데, 이는 이 외부 테스트들이 오직 라이브러리의 공개 API 부분에 속하는 함수들만 호출할 수 있다는 의미.

- 이들의 목적은 라이브러리의 수많은 파트들이 함께 올바르게 동작하는지를 시험하는 것.

- 그 자체로서는 올바르게 동작하는 코드의 단위들도 통합되었을 때는 문제를 일으킬 수 있으므로, 통합된 코드의 테스트 커버율 또한 중요함.

- 통합 테스트를 만들기 위해서는 _tests_ 디렉토리를 먼저 만들 필요가 있음.

### _tests_ 디렉토리
